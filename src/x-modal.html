<element name="x-modal">
    <style>
        x-modal {
          display: block;
          position: fixed;
          top: 50%;
          left: 50%;
          -webkit-box-sizing: border-box;
          -moz-box-sizing: border-box;
          box-sizing: border-box;
          -webkit-transform: translate(-50%, -50%);
          -moz-transform: translate(-50%, -50%);
          -ms-transform: translate(-50%, -50%);
          -o-transform: translate(-50%, -50%);
          transform: translate(-50%, -50%);
          max-width: 100%;
          max-height: 100%;
          overflow: auto;
          background: white;
          border: 1px solid #333;
          z-index: 1;
        }

        x-modal > .x-modal-title {
          background: lightblue;
          position: relative;
          min-height: 20px;
          padding-right: 25px;
        }

        .x-modal-close {
          position: absolute;
          top: 4px;
          right: 3px;
        }
        .x-modal-close:before {
          content: "X";
        }

        x-modal[hidden] {
          display: none;
        }
    </style>
    <template>
    </template>
    <script>
        ({
            show: function() {
                this.removeAttribute('hidden');
            },
            hide: function() {
                this.setAttribute('hidden', '');
            },
            close: function() {
                this.hide();
            },
            readyCallback: function() {
                console.log('ready');
                this.hide();

               // this.querySelector('.x-modal-close').addEventListener('click', this.close.bind(this), false);
                var that = this;
                document.addEventListener('keyup', function(e) {
                    if (e.which === 27 && !that.getAttribute('hidden')) {
                        that.close();
                    }
                }, false);
            },
            attributeChangedCallback: function(attributeName, oldValue) {
                attributeName = attributeName.toLowerCase();
                var newValue = this.getAttribute(attributeName); // paramètre manquant par rapport à la spec CustomElement

                var overlayId = this.getAttribute("overlay");
                if (overlayId) {
                    var overlay =  document.getElementById(overlayId);
                    if (attributeName === 'hidden') {
                        if (newValue === null) {
                            overlay.show();
                        } else {
                            overlay.hide();
                        }
                    }
                }
            }
        });
    </script>
</element>