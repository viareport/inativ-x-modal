<element name="vr-combo-box">
    <style>
        vr-combo-box ul {
            display: none;
        }
        ul[visible] {
          display: block;
        }
    </style>
    <template>
        <input type='text' value="test"/>
        <ul></ul>
    </template>
    <script>
        var getUl = function() {
            // ATTENTION aux remarques déplacées
            return this.querySelector("ul");
        }

        var updateViewData = function() {
            var ul = getUl.call(this);
            
            ul.innerHTML = '';
            var li = document.createElement("li");
            for (var i = 0; i < this.options.length; i++) {
                var dataLi = li.cloneNode();
                dataLi.innerHTML = this.options[i].text || this.options[i].value;
                ul.appendChild(dataLi);
            }   
        };

        var bindDataList = function() {
            var listNode = document.querySelector("#" + this.getAttribute("list"));
            //TODO check on a chopé un datalist, c'est bien un datalist (il a options)
            //FIXME on pourrait tester le type de l'élément listNode == vr-datalist
            if (!listNode || listNode.options === undefined) {
                throw new Error('Invalid node should be a vr-datalist ' + JSON.stringify(listNode));
            }

            this.options = listNode.options;
        };

        ({
            insertedCallback: function() {
                this.querySelector("input").addEventListener("focus", this.focus.bind(this), false);
                
                bindDataList.call(this);
            },

            focus: function() {           
                this.showSuggestions();
            },            

            showSuggestions: function() {
                updateViewData.call(this);
                
                var ul = getUl.call(this);
                ul.setAttribute("visible", "");
            }
        });
    </script>
</element>